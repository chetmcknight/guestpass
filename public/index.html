<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GuestPass - WiFi Guest Card Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: {
                            900: '#000000',
                            800: '#0a0a0a',
                            700: '#141414',
                            600: '#1f1f1f',
                        },
                        neon: {
                            red: '#FF2E54',
                            green: '#00FF94',
                            blue: '#00D1FF'
                        }
                    },
                    boxShadow: {
                        'neon-red': '0 0 20px rgba(255, 46, 84, 0.3)',
                        'neon-green': '0 0 20px rgba(0, 255, 148, 0.2)',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000;
        }

        .dashboard-card {
            background: #121212;
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 24px -1px rgba(0, 0, 0, 0.2);
        }

        .dark-input {
            background: #1E1E1E;
            color: white;
            border: 1px solid transparent;
            transition: all 0.2s ease;
        }

        .dark-input:focus {
            background: #252525;
            border-color: #FF2E54;
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 46, 84, 0.15);
        }

        .dark-input::placeholder {
            color: #666;
        }

        /* Toggle Switch for Password */
        .password-toggle:hover {
            color: #FF2E54;
        }

        .guest-card-print {
            background: white;
            color: #1f2937;
        }

        @media print {
            @page {
                margin: 0;
                size: auto;
            }

            html,
            body {
                height: 100vh !important;
                width: 100vw !important;
                margin: 0 !important;
                padding: 0 !important;
                background: white !important;
                overflow: hidden !important;
            }

            /* Hiding Strategy: Collapse elements fully instead of just hiding visibility */

            /* 1. Hide direct children of body except the app container */
            body>*:not(#app-container) {
                display: none !important;
            }

            /* 2. Style body to center the remaining app container */
            body {
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }

            /* 3. Reset #app-container flow */
            #app-container {
                position: static !important;
                width: auto !important;
                max-width: none !important;
                margin: 0 !important;
                padding: 0 !important;
                transform: none !important;
                display: block !important;
            }

            /* 4. Hide siblings of #result-view inside app-container */
            #app-container>*:not(#result-view) {
                display: none !important;
            }

            /* 5. Reset #result-view flow */
            #result-view {
                display: block !important;
                margin: 0 !important;
                padding: 0 !important;
                animation: none !important;
                width: auto !important;
            }

            /* 6. Hide siblings of card (like buttons) */
            #result-view>*:not(#card-to-print) {
                display: none !important;
            }

            /* 7. The Card Itself */
            #card-to-print {
                display: block !important;
                visibility: visible !important;
                position: relative !important;
                left: auto !important;
                top: auto !important;
                transform: none !important;

                margin: 0 auto !important;
                width: 350px !important;
                /* Slightly smaller to ensure fit */
                max-width: 90vw !important;

                border: 2px solid #000 !important;
                border-radius: 20px !important;
                padding: 32px !important;
                background: white !important;
                color: black !important;
                box-shadow: none !important;

                /* Prevent internal breaks */
                break-inside: avoid !important;
                page-break-inside: avoid !important;

                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            /* Text Color Overrides for Print Clarity */
            #card-to-print h1,
            #card-to-print h2,
            #card-to-print h3,
            #card-to-print p,
            #card-to-print span,
            #display-ssid {
                color: black !important;
                text-shadow: none !important;
            }

            /* Ensure the text container looks right */
            #card-to-print .bg-gray-100 {
                background-color: #f3f4f6 !important;
                border: 1px solid #e5e7eb !important;
            }
        }
    </style>
</head>

<body
    class="flex items-center justify-center min-h-screen p-4 bg-dark-900 text-white selection:bg-neon-red selection:text-white">

    <!-- Decorative Gradients behind -->
    <div class="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 no-print">
        <div class="absolute top-[-20%] right-[-10%] w-[600px] h-[600px] bg-neon-red/10 rounded-full blur-[120px]">
        </div>
        <div class="absolute bottom-[-20%] left-[-10%] w-[500px] h-[500px] bg-neon-blue/5 rounded-full blur-[100px]">
        </div>
    </div>

    <!-- Main Container -->
    <main class="w-full max-w-[420px] relative" id="app-container">

        <!-- Input Form -->
        <div id="input-form"
            class="dashboard-card p-8 no-print transform transition-all duration-500 hover:scale-[1.01]">

            <!-- Header with Icon -->
            <div class="flex items-center justify-between mb-8">
                <div>
                    <h1 class="text-2xl font-bold text-white tracking-tight">GuestPass</h1>
                    <p class="text-gray-500 text-sm mt-1">New network setup</p>
                </div>
                <div
                    class="w-10 h-10 rounded-full bg-gradient-to-tr from-neon-red to-orange-500 flex items-center justify-center shadow-neon-red">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                            d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0" />
                    </svg>
                </div>
            </div>

            <form id="wifi-form" class="space-y-6">
                <!-- SSID Input -->
                <div class="space-y-2">
                    <label for="ssid" class="text-xs font-semibold text-gray-500 uppercase tracking-wider ml-1">Network
                        Name</label>
                    <input type="text" id="ssid" required
                        class="dark-input w-full px-5 py-4 rounded-2xl text-[15px] font-medium"
                        placeholder="e.g. MySuperFastWiFi">
                </div>

                <!-- Password Input -->
                <div class="space-y-2">
                    <label for="password"
                        class="text-xs font-semibold text-gray-500 uppercase tracking-wider ml-1">Password</label>
                    <div class="relative">
                        <input type="password" id="password" required
                            class="dark-input w-full px-5 py-4 rounded-2xl text-[15px] font-medium pr-12"
                            placeholder="••••••••">
                        <button type="button" id="toggle-password"
                            class="password-toggle absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="w-5 h-5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Generate Button -->
                <button type="submit"
                    class="group w-full relative overflow-hidden rounded-2xl bg-gradient-to-r from-neon-red to-orange-500 p-[1px] shadow-neon-red hover:shadow-[0_0_30px_rgba(255,46,84,0.4)] transition-all duration-300 mt-2">
                    <div
                        class="relative bg-black/10 group-hover:bg-transparent transition-colors rounded-2xl w-full h-full py-4 flex items-center justify-center">
                        <span class="font-bold text-white tracking-wide">Generate Card</span>
                        <svg xmlns="http://www.w3.org/2000/svg"
                            class="h-5 w-5 ml-2 transform group-hover:translate-x-1 transition-transform" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 7l5 5m0 0l-5 5m5-5H6" />
                        </svg>
                    </div>
                </button>
            </form>

            <!-- Footer Stat (For Aesthetic) -->
            <div class="mt-8 flex items-center justify-between border-t border-white/5 pt-6">
                <div>
                    <p class="text-xs text-gray-500 font-medium">Security</p>
                    <p class="text-white font-bold text-lg">WPA2/3</p>
                </div>
                <!-- Visual "Chart" element matching user request -->
                <div class="flex items-end space-x-1 h-8">
                    <div class="w-1 bg-gray-700 h-[40%] rounded-t-sm"></div>
                    <div class="w-1 bg-gray-700 h-[60%] rounded-t-sm"></div>
                    <div class="w-1 bg-neon-red h-[80%] rounded-t-sm shadow-[0_0_10px_#FF2E54]"></div>
                    <div class="w-1 bg-gray-700 h-[50%] rounded-t-sm"></div>
                    <div class="w-1 bg-gray-700 h-[70%] rounded-t-sm"></div>
                </div>
            </div>
        </div>

        <!-- Result View (Matches Clean Printable Aesthetic) -->
        <div id="result-view" class="hidden flex-col items-center justify-center space-y-6 animate-fade-in-up">

            <!-- The Printable Card -->
            <div id="card-to-print"
                class="guest-card-print bg-white p-8 rounded-3xl w-full max-w-sm text-center shadow-2xl relative overflow-hidden print-area">
                <div class="mb-6 flex justify-center">
                    <div class="p-4 bg-black rounded-2xl">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0" />
                        </svg>
                    </div>
                </div>

                <h2 class="text-3xl font-extrabold text-black tracking-tight mb-2">WiFi</h2>
                <p class="text-gray-500 mb-8 font-medium">Scan to connect</p>

                <div class="flex justify-center mb-8">
                    <img id="qr-image" src="" alt="WiFi QR Code" class="w-56 h-56 rounded-xl mix-blend-multiply">
                </div>

                <div class="bg-gray-100 rounded-2xl p-4 text-left border border-gray-200">
                    <p class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-1">Network Name</p>
                    <p id="display-ssid" class="text-xl font-bold text-black break-words"></p>
                </div>
            </div>

            <!-- Dashboard Actions -->
            <div class="flex space-x-3 no-print w-full">
                <button onclick="window.print()"
                    class="flex-1 bg-white text-black font-bold py-4 rounded-2xl hover:bg-gray-200 transition-colors flex items-center justify-center gap-2">
                    Print Card
                </button>
                <button onclick="resetApp()"
                    class="flex-1 dashboard-card text-white font-bold py-4 rounded-2xl hover:bg-[#1a1a1a] transition-colors flex items-center justify-center gap-2 border-transparent hover:border-white/20">
                    Create New
                </button>
            </div>
        </div>
    </main>

    <script>
        const form = document.getElementById('wifi-form');
        const inputContainer = document.getElementById('input-form');
        const resultView = document.getElementById('result-view');
        const qrImage = document.getElementById('qr-image');
        const displaySsid = document.getElementById('display-ssid');
        const togglePassword = document.getElementById('toggle-password');
        const passwordInput = document.getElementById('password');

        // Toggle Password Visibility
        togglePassword.addEventListener('click', () => {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            // Update Icon
            togglePassword.innerHTML = type === 'password'
                ? '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>'
                : '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88" /></svg>';
        });

        function resetApp() {
            resultView.classList.add('hidden');
            resultView.classList.remove('flex');
            inputContainer.classList.remove('hidden');
            form.reset();
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const ssid = document.getElementById('ssid').value;
            const password = passwordInput.value;
            const button = form.querySelector('button[type="submit"] div span');
            const originalText = button.innerText;

            button.innerText = 'Creating...';
            // button.disabled = true; // disabled styling is tricky with custom buttons, just prevent double submit via logic if needed

            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ssid, password })
                });

                const data = await response.json();

                if (response.ok) {
                    qrImage.src = data.image;
                    displaySsid.textContent = data.ssid;

                    // Animate transition
                    inputContainer.classList.add('hidden');
                    resultView.classList.remove('hidden');
                    resultView.classList.add('flex');
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (err) {
                alert('An error occurred. Please try again.');
                console.error(err);
            } finally {
                button.innerText = "Generate Card";
            }
        });
    </script>
</body>

</html>